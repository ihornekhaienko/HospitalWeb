function increment(){try{let n=document.getElementById("notifications-count"),t=n.textContent;t?n.textContent=+t+1:n.appendChild(document.createTextNode("1"))}catch(n){console.log(n.message)}}function decrement(){try{let n=document.getElementById("notifications-count"),t=n.textContent;n.textContent=+t==1?null:+t-1}catch(n){console.log(n.message)}}function removeNotification(n){try{let t=document.getElementById("notifications"),i=t.firstChild;i&&(t.removeChild(i),decrement());n.stopPropagation();n.preventDefault()}catch(t){console.log(t.message)}}function updatePopover(){try{const n=[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));n.map(n=>{let t={animation:!1};n.hasAttribute("data-bs-content-id")&&(t.content=document.getElementById(n.getAttribute("data-bs-content-id")).innerHTML,t.html=!0);new bootstrap.Popover(n,t)})}catch(n){console.log(n.message)}}function updatePageLink(){let n=document.getElementsByClassName("pagination")[0];console.log(n);let t=n.children.length+1;if(console.log(n),console.log(t),!(t>2)){let u=document.URL.split("?")[0]+"?page="+t,i=document.createElement("a");i.classList.add("page-link");i.setAttribute("href",u);i.innerHTML=t;let r=document.createElement("li");r.classList.add("page-item");r.appendChild(i);n.classList.remove("d-none");n.appendChild(r)}}function createNotificationDiv(n,t,i="alert-info"){let r=document.createElement("div");r.classList.add("alert");r.classList.add(i);r.classList.add("p-1");r.classList.add("mb-1");let u=document.createElement("h6");u.classList.add("alert-heading");u.appendChild(document.createTextNode(n));r.appendChild(u);let f=document.createElement("p");return f.classList.add("m-0"),f.appendChild(document.createTextNode(t)),r.appendChild(f),r}function notifySignUp(n,t,i){try{hubConnection.invoke("NotifySignUp",n,t,i)}catch(r){console.log(r.message)}}function getNotificationType(n){switch(n){case 0:return"alert-secondary";case 1:return"alert-danger";case 2:return"alert-success";case 3:return"alert-primary";default:return"alert-info"}}function loadLatest(){$.ajax({type:"POST",url:"/Home/LoadLatestNotifications",dataType:"json",contentType:"application/json",success:function(n){if(n!=null){let t=document.getElementById("notifications");t.innerHTML="";let i=document.getElementById("notifications-count");i.innerHTML="";for(let i of n){let n=getNotificationType(i.type),r=createNotificationDiv(i.topic,i.message,n);t.appendChild(r);increment()}updatePopover()}},error:function(n){console.log(n)}})}function notifyCancel(n,t,i){try{hubConnection.invoke("NotifyCancel",n,t,i)}catch(r){console.log(r.message)}}function notifyFill(n,t,i){try{hubConnection.invoke("NotifyFill",n,t,i)}catch(r){console.log(r.message)}}function read(n){try{$.ajax({url:"/Manage/ReadNotification",data:{id:n.toString()},contentType:"application/json",success:function(){let t=document.getElementById("alert-"+n);console.log(t);t.classList.remove("alert-success");t.classList.remove("alert-danger");t.classList.remove("alert-primary");t.classList.add("alert-secondary");loadLatest()},error:function(n){console.log(n.responseText)}})}catch(t){console.log(t.message)}}function confirmSignUp(n){return confirm(n)}function updateAppoitmentsStates(){$.ajax({url:"https://localhost:7271/jobs/updateStates",type:"POST",crossDomain:!0,headers:{accept:"application/json","Access-Control-Allow-Origin":"*"},success:function(){console.log("states update")},error:function(){console.log("states update failed")}})}const hubConnection=(new signalR.HubConnectionBuilder).withUrl("/NotificationHub").build();hubConnection.on("NotifySignUp",function(n,t){try{let r=document.getElementById("notifications");r.insertBefore(createNotificationDiv(n,t,"alert-primary"),r.firstChild);r.children.length>5&&(i.removeChild(i.lastElementChild),updatePageLink());let i=document.getElementById("notifications-profile");if(i){let r=document.createElement("div");r.classList.add("row");r.appendChild(createNotificationDiv(n,t,"alert-primary"));i.insertBefore(r,i.firstChild);i.children.length>5&&(i.removeChild(i.lastElementChild),updatePageLink())}increment();updatePopover()}catch(i){console.log(i.message)}});hubConnection.on("NotifyCancel",function(n,t){try{let r=document.getElementById("notifications");r.insertBefore(createNotificationDiv(n,t,"alert-danger"),r.firstChild);r.children.length>5&&(i.removeChild(i.lastElementChild),updatePageLink());let i=document.getElementById("notifications-profile");if(i){let r=document.createElement("div");r.classList.add("row");r.appendChild(createNotificationDiv(n,t,"alert-danger"));i.insertBefore(r,i.firstChild);i.children.length>5&&(i.removeChild(i.lastElementChild),updatePageLink())}increment();updatePopover()}catch(i){console.log(i.message)}});hubConnection.on("NotifyFill",function(n,t){try{let r=document.getElementById("notifications");r.insertBefore(createNotificationDiv(n,t,"alert-success"),r.firstChild);r.children.length>5&&(i.removeChild(i.lastElementChild),updatePageLink());let i=document.getElementById("notifications-profile");if(i){let r=document.createElement("div");r.classList.add("row");r.appendChild(createNotificationDiv(n,t,"alert-success"));i.insertBefore(r,i.firstChild);i.children.length>5&&(i.removeChild(i.lastElementChild),updatePageLink())}increment();updatePopover()}catch(i){console.log(i.message)}});$(document).ready(function(){loadLatest()});hubConnection.start();$("#activator").click(function(){$("#uploader").click()});$("#uploader").change(function(){this.form.submit()});updateAppoitmentsStates();